<html>
    <head>
        <title>wasm example</title>
    </head>
    <body>
        <svg width="400" height="400" id="base">
            <path id="basePath" d="M100,250 C100,100 400,100 400,250 L100,250" stroke="blue" stroke-width="5" fill="none" />
        </svg>
        
        <svg width="400" height="400" id="modified">
            <path id="modifiedPath" stroke="blue" stroke-width="5" fill="none" />
        </svg>

        <script type="text/javascript">
            let wasm = null;
            Module = {}
        
            const base = document.getElementById('base');
            const modified = document.getElementById('modified')

            const basePath = document.getElementById('basePath');
            const modifiedPath = document.getElementById('modifiedPath')

            fetch('add.wasm')
                .then(response=> response.arrayBuffer())
                .then(buffer => WebAssembly.instantiate(buffer,Module))
                .then(results=>{

                    wasm = results.instance.exports
                    let memoryIn = new Uint8Array(wasm.memory.buffer, wasm.get_memory_in(),1024)
                    let memoryOut = new Uint8Array(wasm.memory.buffer, wasm.get_memory_out(),1024)

                    var pathString = basePath.getAttribute('d');

                    for (var i = 0; i < pathString.length; i++){  
                        memoryIn[i] = pathString.charCodeAt(i);
                    }
                    wasm.leftb(0.2);
                    var pathString2 = "";
                    let index = 0;
                    while (memoryOut[index] > 0) {
                        pathString2 += String.fromCharCode(memoryOut[index]);
                        index++;
                    }

                    modifiedPath.setAttribute('d',pathString2);                    
                })
        </script>
    
    </body>
</html>